---
description: 
globs: *.rs, Cargo.toml, Anchor.toml
alwaysApply: false
---
# contracts.rules

• Target Solana 1.18 with Anchor master (patched); nightly toolchain allowed only via rustup override in `/contracts`:
    rustup toolchain install nightly-2025-04-16
    rustup override set nightly-2025-04-16
• Always run `scripts/apply_anchor_fix.sh` before the first build; install/upgrade CLI with `pnpm run anchor:install`.
• Each instruction handler ≤ 120 LOC; heavy logic lives in helpers (`processor.rs`, `utils/*`).
• PDA seeds begin with `b"chessbets"` plus contextual seeds; include `bump`.
• Integer math only for lamports; use `checked_*` ops to avoid overflow.
• Emit an event for every state‑change; event structs in `CamelCase`.
• Public structs/enums carry rust‑docs explaining every field.
• Unit‑test with Anchor Mocha; enforce exact lamport splits (±1 lamport max).
• Build with `anchor build -- --locked`; CI uses the same pinned toolchain.

Cursor Pattern Matches:
contracts/**/*.rs, Anchor.toml, Cargo.toml, **/*.md